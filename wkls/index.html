<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="/wkls/styles.css">
    <link rel="icon" href="/wkls/favicon.png">
    <title>WKLS Report Generator</title>
</head>

<body>
    <div class="video-container">
        <video autoplay muted loop id="video">
            <source src="/wkls/bg.mp4" type="video/mp4">
        </video>
    </div>
    <div class="container">
        <h1><img src="/wkls/logo.png" alt="Logo" class="h1logo">Report Generator</h1>
        <div class="form-section">
            <h2><img src="/wkls/student.png" alt="Student Icon" class="h2logo">Details</h2>
            <input type="text" id="studentName" name="studentName" placeholder="Enter student's name">
        </div>
        <div class="slider-section">
            <div class="slider-container">
                <label class="slider-label" for="grade">Grade</label>
                <input type="range" id="grade" name="grade" min="0" max="6" step="1">
                <span class="slider-value" id="gradeValue">3</span>
            </div>

            <div class="slider-container">
                <label class="slider-label" for="attendance">Attendance</label>
                <input type="range" id="attendance" name="attendance" min="0" max="4" step="1">
                <span class="slider-value" id="attendanceValue">Satisfactory</span>
            </div>
        </div>

        <div class="slider-section">
            <div class="slider-container">
                <label class="slider-label" for="behaviour">Behaviour:</label>
                <input type="range" id="behaviour" name="behaviour" min="0" max="4" step="1">
                <span class="slider-value" id="behaviourValue">Satisfactory</span>
            </div>

            <div class="slider-container">
                <label class="slider-label" for="effort">Effort:</label>
                <input type="range" id="effort" name="effort" min="0" max="4" step="1">
                <span class="slider-value" id="effortValue">Satisfactory</span>
            </div>
        </div>

        <div class="checkbox-group">
            <div class="checkbox-group-item">
                <h2><img src="/wkls/listening.png" alt="Listening Icon" class="h2logo">Listening</h2>
                <div class="checkboxes" id="listeningCheckboxes"></div>
            </div>

            <div class="checkbox-group-item">
                <h2><img src="/wkls/reading.png" alt="Reading Icon" class="h2logo">Reading</h2>
                <div class="checkboxes" id="readingCheckboxes"></div>
            </div>
        </div>

        <div class="checkbox-group">
            <div class="checkbox-group-item">
                <h2><img src="/wkls/speaking.png" alt="Speaking Icon" class="h2logo">Speaking</h2>
                <div class="checkboxes" id="speakingCheckboxes"></div>
            </div>

            <div class="checkbox-group-item">
                <h2><img src="/wkls/writing.png" alt="Writing Icon" class="h2logo">Writing</h2>
                <div class="checkboxes" id="writingCheckboxes"></div>
            </div>
        </div>

        <div class="comment-section">
            <h2><img src="/wkls/comment.png" alt="Comment Icon" class="h2logo">Overall Comment</h2>
            <textarea id="overallComment" class="comment-box"
                placeholder="Enter your overall feedback here. Need help? Click the 'Brush' button below for AI-generated suggestions."></textarea>
            <span id="characterCount">0/1500</span>
        </div>
        <button id="brushBtn"><i class="fas fa-magic"></i></button>
        <button id="generateReportBtn">Generate Report</button>
    </div>

    <script>
        function createCheckboxes(containerId, options, maxAllowed) {
            const container = document.getElementById(containerId);
            let selectedCheckboxes = 0;

            options.forEach(option => {
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.name = containerId;
                checkbox.value = option;

                const label = document.createElement('label');
                label.className = 'checkbox-label';
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(option));

                container.appendChild(label);
                container.appendChild(document.createElement('br'));

                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        selectedCheckboxes++;
                    } else {
                        selectedCheckboxes--;
                    }

                    if (selectedCheckboxes > maxAllowed) {
                        checkbox.checked = false;
                        selectedCheckboxes--;
                    }
                });
            });
        }

        createCheckboxes('listeningCheckboxes', [
            "Responds to inquiries related to studied texts",
            "Displays enthusiasm for listening to texts and successfully answers corresponding questions",
            "Attentively replicates language usage modeled by the teacher and actively engages in oral language activities",
            "Comprehends words and phrases by responding to questions and following routine classroom instructions",
            "Proficiently counts and identifies colors, shapes, and objects in the language",
            "Demonstrates the capacity to comprehend aural texts, extracting and recording received information",
            "Exhibits exceptional understanding of classroom instructions and directions",
            "Demonstrates proficient sound discrimination skills",
            "Eagerly participates in dramatizations, including role-plays, singing, and games",
            "Effectively listens to aural texts, accurately analyzes information, and utilizes it in spoken responses",
            "Listens to brief texts and exhibits understanding",
            "Displays excellent familiarity with the studied language while listening to spoken words",
            "Grasps both the main points and specific details in listening tasks",
            "Shows enjoyment in listening to stories and consistently answers related questions",
            "Makes attempts to incorporate familiar words in class discussions",
            "Conveys the main points of spoken texts by responding orally to questions",
            "Demonstrates understanding by answering questions correctly, selecting suitable responses, and completing charts",
            "Displays a solid understanding of instructions and directions given in class",
        ], 3);

        createCheckboxes('readingCheckboxes', [
            "Participates actively in choral reading sessions and can identify familiar words",
            "Engages actively in shared reading exercises",
            "Confidently discerns letter-sound relationships",
            "Successfully finds specific words in familiar texts and can sound out words",
            "Reads aloud confidently with accurate pronunciation, appropriate pace, and expression",
            "Displays a strong understanding of texts covering various topics",
            "Demonstrates clear language pronunciation",
            "Derives enjoyment from reading passages and readily answers questions about the material",
            "Fluently reads aloud, grasping the meaning",
            "Identifies specific characters in flashcard games",
            "Identifies specific letters in flashcard games",
            "Recognizes and names many alphabet letters, demonstrating their corresponding sounds",
            "Reads and comprehends simple and familiar texts",
            "Reads familiar texts with confidence, often locating specific words",
            "Accurately and fluently reads homework assignments",
            "Reads with high accuracy and understanding",
            "Reads words and phrases in familiar texts and provides key terms during shared reading activities",
            "Recognizes and can name all alphabet letters along with their corresponding sounds",
            "Identifies the names and sounds of numerous letters",
            "Regularly practices reading at home"
        ], 3);

        createCheckboxes('speakingCheckboxes', [
            "Actively engages in classroom discussions, expressing ideas using familiar vocabulary",
            "Participates enthusiastically in language games during class",
            "Takes an active role in short drama activities, showcasing excellent pronunciation",
            "Enjoys singing songs learned in class and confidently performs them when required",
            "Effectively communicates with partners, utilizing various strategies to sustain and enhance conversations",
            "Presented a well-prepared and confidently delivered speaking task, showing continuous improvement in this area",
            "Conducted an oral presentation that was thoroughly researched, highly informative, and engaging",
            "Demonstrated a strong command of relevant vocabulary and sentence structures, successfully exchanging information",
            "Displayed a solid ability to converse in the language, incorporating appropriate expression, pronunciation, and intonation",
            "Showed the ability to communicate fluently and purposefully in various situations",
            "Engaged in conversations confidently and fluently",
            "Expresses preferences and dislikes using the language",
            "Delivers fluent introductions and can greet, bid farewell, express gratitude, and apologize in the language",
            "Greets the teacher and peers using culturally appropriate language and gestures",
            "Identifies the names of visible objects and items from auditory and visual cues",
            "Learned how to make introductions and greet and bid farewell to others using language appropriate for different situations",
            "Oral skills were of a high caliber, reflecting an understanding of cultural nuances, excellent pronunciation, and intonation",
            "Performed oral tasks at this level clearly, demonstrating preparedness and appropriate skills and expression",
        ], 3);

        createCheckboxes('writingCheckboxes', [
            "A conscientious and diligent student demonstrating a proficient level in presentations and written expression",
            "Accurately duplicates words and/or sentences",
            "Applies knowledge and skills to a high degree in writing assignments",
            "Communicates effectively, reproducing and creating new language sequences based on modeled written activities",
            "Completes charts, captions, and comprehension tasks to an exceptionally high standard",
            "Solves simple crosswords and matches topics covered in class competently",
            "Carries out written activities with competence",
            "Mimics characters from provided examples",
            "Imitates characters to label illustrations",
            "Reproduces simple sentences from modeled examples",
            "Duplicates words and sentences to label illustrations",
            "Copies words and sentences to label illustrations related to class topics",
            "Composes basic original texts tailored for specific audiences and purposes, utilizing precise language for the chosen topic",
            "Demonstrates meticulous attention to detail, including the use of accents and punctuation",
            "Exhibits excellent skills and cultural awareness in selecting appropriate and accurate vocabulary and sentence patterns in writing",
            "Shows the ability to compose emails and understand conventions for letter writing",
            "Displays enthusiasm for learning the language, evident through the eagerness to acquire new vocabulary and incorporate it into various text types",
            "Enthusiastic language learner keen on acquiring new vocabulary and structures, integrating them into language tasks",
            "Generates simple sentences and spells new words based on familiar sounds"
        ], 3);

        const gradeSlider = document.getElementById('grade');
        const gradeValueSpan = document.getElementById('gradeValue');
        gradeSlider.addEventListener('input', () => {
            if (gradeSlider.value === '0') {
                gradeValueSpan.textContent = 'Prep';
            } else {
                gradeValueSpan.textContent = gradeSlider.value;
            }
        });
        const sliders = ['attendance', 'effort', 'behaviour'];
        sliders.forEach(sliderId => {
            const slider = document.getElementById(sliderId);
            const valueSpan = document.getElementById(sliderId + 'Value');
            slider.addEventListener('input', () => {
                let selectedValue = '';
                switch (slider.value) {
                    case '0':
                        selectedValue = 'Very Low';
                        break;
                    case '1':
                        selectedValue = 'Needs Attention';
                        break;
                    case '2':
                        selectedValue = 'Satisfactory';
                        break;
                    case '3':
                        selectedValue = 'High';
                        break;
                    case '4':
                        selectedValue = 'Excellent';
                        break;
                }
                valueSpan.textContent = `${selectedValue}`;
            });
        });

        document.getElementById('brushBtn').addEventListener('click', function (event) {
            const studentName = document.getElementById('studentName');
            const grade = document.getElementById('grade');
            const attendance = document.getElementById('attendance');
            const effort = document.getElementById('effort');
            const behaviour = document.getElementById('behaviour');
            const overallComment = document.getElementById('overallComment');
            const listeningCheckboxes = document.getElementsByName('listeningCheckboxes');
            const readingCheckboxes = document.getElementsByName('readingCheckboxes');
            const speakingCheckboxes = document.getElementsByName('speakingCheckboxes');
            const writingCheckboxes = document.getElementsByName('writingCheckboxes');

            function getSelectedCheckboxValues(checkboxes) {
                const selectedValues = [];
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        selectedValues.push(checkbox.value);
                    }
                });
                return selectedValues;
            }
            const data = {
                studentName: studentName.value,
                grade: grade.value,
                listeningSkills: getSelectedCheckboxValues(listeningCheckboxes),
                readingSkills: getSelectedCheckboxValues(readingCheckboxes),
                speakingSkills: getSelectedCheckboxValues(speakingCheckboxes),
                writingSkills: getSelectedCheckboxValues(writingCheckboxes),
                attendance: attendance.value,
                effort: effort.value,
                behaviour: behaviour.value,
            };
            fetch('/api/mlwklsbrush', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Network response was not ok.');
                })
                .then(responseData => {
                    overallComment.value = responseData.updatedComment;
                    const characterCount = overallComment.value.length;
                    characterCountSpan.textContent = `${characterCount}/${maxCharacters}`;
                })
                .catch(error => {
                    console.error('Error making API call:', error);
                });
        });


        document.getElementById('generateReportBtn').addEventListener('click', function (event) {
            const studentName = document.getElementById('studentName');
            const grade = document.getElementById('grade');
            const attendance = document.getElementById('attendance');
            const effort = document.getElementById('effort');
            const behaviour = document.getElementById('behaviour');
            const overallComment = document.getElementById('overallComment');
            const listeningCheckboxes = document.getElementsByName('listeningCheckboxes');
            const readingCheckboxes = document.getElementsByName('readingCheckboxes');
            const speakingCheckboxes = document.getElementsByName('speakingCheckboxes');
            const writingCheckboxes = document.getElementsByName('writingCheckboxes');

            function getSelectedCheckboxValues(checkboxes) {
                const selectedValues = [];
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        selectedValues.push(checkbox.value);
                    }
                });
                return selectedValues;
            }
            const data = {
                studentName: studentName.value,
                grade: grade.value,
                listeningSkills: getSelectedCheckboxValues(listeningCheckboxes),
                readingSkills: getSelectedCheckboxValues(readingCheckboxes),
                speakingSkills: getSelectedCheckboxValues(speakingCheckboxes),
                writingSkills: getSelectedCheckboxValues(writingCheckboxes),
                attendance: attendance.value,
                effort: effort.value,
                behaviour: behaviour.value,
                overallComment: overallComment.value
            };
            fetch('/api/mlwklsgenerate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    if (response.ok) {
                        return response.blob();
                    }
                    throw new Error('Network response was not ok.');
                })
                .then(blob => {
                    const studentName = document.getElementById('studentName').value.replace(/[^a-zA-Z0-9]/g, '_');
                    const blobWithStudentName = new Blob([blob], { type: 'application/pdf' });
                    const a = document.createElement('a');
                    a.href = window.URL.createObjectURL(blobWithStudentName);
                    a.download = `${studentName}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(a.href);
                    document.body.removeChild(a);
                })
                .catch(error => {
                    console.error('Error generating report:', error);
                });

        });

        const maxCharacters = 1500;
        const overallCommentTextarea = document.getElementById('overallComment');
        const characterCountSpan = document.getElementById('characterCount');

        overallCommentTextarea.addEventListener('input', function () {
            const characterCount = overallCommentTextarea.value.length;
            characterCountSpan.textContent = `${characterCount}/${maxCharacters}`;

            if (characterCount > maxCharacters) {
                overallCommentTextarea.value = overallCommentTextarea.value.substring(0, maxCharacters);
                characterCountSpan.textContent = `${maxCharacters}/${maxCharacters}`;
            }
        });

    </script>
</body>

</html>
