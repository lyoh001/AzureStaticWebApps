<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="/wkls/styles.css">
    <link rel="icon" href="/wkls/favicon.png">
    <title>WKLS Report Generator</title>
</head>

<body>
    <div class="video-container">
        <video autoplay muted loop id="video">
            <source src="/wkls/bg.mp4" type="video/mp4">
        </video>
    </div>
    <div class="container">
        <h1><img src="/wkls/logo.png" alt="Logo" class="h1logo">Report Generator</h1>
        <div class="form-section">
            <label class="label" for="studentName">Student's Name</label>
            <input type="text" id="studentName" name="studentName" placeholder="Enter student's name">
        </div>
        <div class="slider-section">
            <div class="slider-container">
                <label class="slider-label" for="grade">Grade</label>
                <input type="range" id="grade" name="grade" min="0" max="9" step="1" value="0">
                <span class="slider-value" id="gradeValue">Prep</span>
            </div>

            <div class="slider-container">
                <label class="slider-label" for="attendance">Attendance</label>
                <input type="range" id="attendance" name="attendance" min="0" max="4" step="1">
                <span class="slider-value" id="attendanceValue">Satisfactory</span>
            </div>
        </div>

        <div class="slider-section">
            <div class="slider-container">
                <label class="slider-label" for="behaviour">Behaviour:</label>
                <input type="range" id="behaviour" name="behaviour" min="0" max="4" step="1">
                <span class="slider-value" id="behaviourValue">Satisfactory</span>
            </div>

            <div class="slider-container">
                <label class="slider-label" for="effort">Effort:</label>
                <input type="range" id="effort" name="effort" min="0" max="4" step="1">
                <span class="slider-value" id="effortValue">Satisfactory</span>
            </div>
        </div>

        <div class="checkbox-group">
            <div class="checkbox-group-item">
                <h2><img src="/wkls/communication.png" alt="Communication Icon" class="h2logo">Communication</h2>
                <div class="checkboxes" id="communicationCheckboxes"></div>
            </div>

            <div class="checkbox-group-item">
                <h2><img src="/wkls/understanding.png" alt="Understanding Icon" class="h2logo">Understanding</h2>
                <div class="checkboxes" id="understandingCheckboxes"></div>
            </div>
        </div>

        <div class="comment-section">
            <h2><img src="/wkls/comment.png" alt="Comment Icon" class="h2logo">Overall Comment</h2>
            <textarea id="overallComment" class="comment-box"
                placeholder="Enter your overall feedback here. Need help? Click the 'Brush' button below for AI-generated suggestions."></textarea>
            <span id="characterCount">0/1500</span>
        </div>
        <button id="brushBtn"><i class="fas fa-magic"></i></button>
        <button id="generateReportBtn">Generate Report</button>
    </div>

    <script>
        function createCheckboxes(containerId, options, maxAllowed, gradeGroup) {
            const container = document.getElementById(containerId);
            let selectedCheckboxes = 0;

            const checkboxes = options[gradeGroup];
            checkboxes.forEach(option => {
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.name = containerId;
                checkbox.value = option;

                const label = document.createElement('label');
                label.className = 'checkbox-label';
                label.appendChild(checkbox);

                if (option.includes('[High]')) {
                    checkbox.style.border = '2px solid #00a2f9';
                } else if (option.includes('[Medium]')) {
                    checkbox.style.border = '2px solid #f9c542';
                } else if (option.includes('[Low]')) {
                    checkbox.style.border = '2px solid #ff686b';
                }

                label.appendChild(document.createTextNode(option.replace(/\[.*?\]/, '')));
                container.appendChild(label);
                container.appendChild(document.createElement('br'));
                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        checkbox.style.backgroundColor = getCheckboxBackgroundColor(option);
                        selectedCheckboxes++;
                    } else {
                        checkbox.style.backgroundColor = '';
                        selectedCheckboxes--;
                    }

                    if (selectedCheckboxes > maxAllowed) {
                        checkbox.checked = false;
                        checkbox.style.backgroundColor = '';
                        selectedCheckboxes--;
                    }
                });
            });

            function getCheckboxBackgroundColor(option) {
                if (option.includes('[High]')) {
                    return '#00a2f9';
                } else if (option.includes('[Medium]')) {
                    return '#f9c542';
                } else if (option.includes('[Low]')) {
                    return '#ff686b';
                }
                return '';
            }
        }

        const gradeSlider = document.getElementById('grade');
        const communicationCheckboxesContainer = document.getElementById('communicationCheckboxes');
        const understandingCheckboxesContainer = document.getElementById('understandingCheckboxes');

        window.addEventListener('load', () => {
            createCheckboxes('communicationCheckboxes', [
                ["[High] can confidently exchange simple Korean greetings, using appropriate experssion and body language.",
                    "[High] confidently participates in songs and chants by singing and performing actions.",
                    "[High] can confidently demonstrate their understanding of early literacy skils by labelling, matching, drawing and using gestures to locate and use information.",
                    "[Medium] can satisfactorily exchanges simple Korean greetings, using appropriate expression and body language.",
                    "[Medium] can satisfactorily participate in songs and chants by singing and performing actions.",
                    "[Medium] can satisfactorily follow simple classroom instructions.",
                    "[Low] is beginning to exchange simple Korean greetings, using some appropriate expression and body language.",
                    "[Low] is beginning to participate in songs and chants by singing and performing simple actions.",
                    "[Low] is beginning to make simple statements about themselves, including who they are and their personal preferences.",]
            ], 5, 0);

            createCheckboxes('understandingCheckboxes', [
                ["[High] can confidently sing the sounds of letters and syllable blocks of hangeul.",
                    "[High] confidently identify -요 at the end of a sentence as indicating some polite meaning.",
                    "[High] confidently identify differences and similarities between their own and others' languages and cultures.",
                    "[Medium] can satisfactorily sing the sounds of letters and syllable blocks of hangeul.",
                    "[Medium] can satisfactorily use simple vacabulary to identify familiar objects and to describe simple actions or states.",
                    "[Medium] satisfactorily identify differences and similarities between their own and others' languages and cultures.",
                    "[Low] is beginning to identify -요 at the end of a sentence as indicating some polite meaning.",
                    "[Low] is beginning to use simple vacabulary to identify familiar objects and to describe simple actions or states.",
                    "[Low] is beginning to identify differences and similarities between their own and others' languages and cultures.",
                ]
            ], 5, 0);
        });
        gradeSlider.addEventListener('input', () => {
            const selectedGrade = parseInt(gradeSlider.value);
            if (selectedGrade >= 0 && selectedGrade <= 2) {
                communicationCheckboxesContainer.innerHTML = '';
                createCheckboxes('communicationCheckboxes', [
                    ["[High] can confidently exchange simple Korean greetings, using appropriate experssion and body language.",
                        "[High] confidently participates in songs and chants by singing and performing actions.",
                        "[High] can confidently demonstrate their understanding of early literacy skils by labelling, matching, drawing and using gestures to locate and use information.",
                        "[Medium] can satisfactorily exchanges simple Korean greetings, using appropriate expression and body language.",
                        "[Medium] can satisfactorily participate in songs and chants by singing and performing actions.",
                        "[Medium] can satisfactorily follow simple classroom instructions.",
                        "[Low] is beginning to exchange simple Korean greetings, using some appropriate expression and body language.",
                        "[Low] is beginning to participate in songs and chants by singing and performing simple actions.",
                        "[Low] is beginning to make simple statements about themselves, including who they are and their personal preferences.",]
                ], 5, 0);
                understandingCheckboxesContainer.innerHTML = '';
                createCheckboxes('understandingCheckboxes', [
                    ["[High] can confidently sing the sounds of letters and syllable blocks of hangeul.",
                        "[High] confidently identify -요 at the end of a sentence as indicating some polite meaning.",
                        "[High] confidently identify differences and similarities between their own and others' languages and cultures.",
                        "[Medium] can satisfactorily sing the sounds of letters and syllable blocks of hangeul.",
                        "[Medium] can satisfactorily use simple vacabulary to identify familiar objects and to describe simple actions or states.",
                        "[Medium] satisfactorily identify differences and similarities between their own and others' languages and cultures.",
                        "[Low] is beginning to identify -요 at the end of a sentence as indicating some polite meaning.",
                        "[Low] is beginning to use simple vacabulary to identify familiar objects and to describe simple actions or states.",
                        "[Low] is beginning to identify differences and similarities between their own and others' languages and cultures.",
                    ]
                ], 5, 0);
            } else if (selectedGrade >= 3 && selectedGrade <= 4) {
                communicationCheckboxesContainer.innerHTML = '';
                createCheckboxes('communicationCheckboxes', [
                    ["[High] can socialise and build relationship with peers and teachers through the exchange of personal in formation in relation to self, friends and family members with confidence.",
                        "[High] can competently participate in collaborative tasks and shared experiences such as creating and playing simple language games or dialogues that involve simple negotiation, or preparting and presenting a group display.",
                        "[High] can competently participate in everyday classroom activities such as responding to teacher's instructions, attracting attention and asking for repetition.",
                        "[Medium] can socialise and build relationship with peers and teachers through the exchange of personal in formation in relation to self, friends and family members with support.",
                        "[Medium] can satisfactorily participate in collaborative tasks and shared experiences such as creating and playing simple language games or dialogues that involve simple negotiation, or preparting and presenting a group display.",
                        "[Medium] can satisfactorily participate in everyday classroom activities such as responding to teacher's instructions, attracting attention and asking for repetition.",
                        "[Low] struggles to socialise and build relationship with peers and teachers through the exchange of personal in formation in relation to self, friends and family members.",
                        "[Low] is learning to recognise on each others' ways of communicating and their appropriateness in Korean or non-Korean contexts.",
                        "[Low] struggles to create own profile using spoken, written or digital forms of expression to identify roles in or memberships of various groups.",]
                ], 5, 0);
                understandingCheckboxesContainer.innerHTML = '';
                createCheckboxes('understandingCheckboxes', [
                    ["[High] can competently recognise characteristics of Korean pronunciation and intonation patterns, the alphabetical nature of Hangeul, and the structural features of individual syllable blocks including 받침.",
                        "[High] can competently understand and use key grammatical forms and structures such as basic pronouns and case markers and the polite verb ending –어/아요 in own simple language production, and recognise politeness embedded in humble or honorific forms such as 저 and –(으)세요",
                        "[High] can competently compare and reflect on different ways of using language in everyday situations in Korean, Australian and other cultures, sharing ideas about possible reasons for the differences and variations ",
                        "[Medium] can satisfactorily recognise characteristics of Korean pronunciation and intonation patterns, the alphabetical nature of Hangeul, and the structural features of individual syllable blocks including 받침.",
                        "[Medium] can understand that languages change over time and influence each other through contact and cultural exchanges to some degree.",
                        "[Medium] can satisfactorily compare and reflect on different ways of using language in everyday situations in Korean, Australian and other cultures, sharing ideas about possible reasons for the differences and variations ",
                        "[Low] struggles to recognise characteristics of Korean pronunciation and intonation patterns, the alphabetical nature of Hangeul, and the structural features of individual syllable blocks including 받침.",
                        "[Low] struggles to reflect on and share their experience when using Korean and when using own language/s, recognising cultural elements that may cause different feelings.",
                        "[Low] struggles to compare and reflect on different ways of using language in everyday situations in Korean, Australian and other cultures, sharing ideas about possible reasons for the differences and variations ",
                    ]
                ], 5, 0);
            } else if (selectedGrade >= 5 && selectedGrade <= 9) {
                communicationCheckboxesContainer.innerHTML = '';
                createCheckboxes('communicationCheckboxes', [
                    ["[High] can understand that languages change over time and influence each other through contact and cultural exchanges.",
                        "[High] can reflect on and share their experience when using Korean and when using own language/s, recognising cultural elements that may cause different feelings.",
                        "[High] can competently compare and reflect on different ways of using language in everyday situations in Korean, Australian and other cultures, sharing ideas about possible reasons for the differences and variations ",
                        "[Medium] can satisfactorily recognise characteristics of Korean pronunciation and intonation patterns, the alphabetical nature of Hangeul, and the structural features of individual syllable blocks including 받침.",
                        "[Medium] can reflect on and share their experience when using Korean and when using own language/s, recognising cultural elements that may cause different feelings to some degree.",
                        "[Medium] can satisfactorily compare and reflect on different ways of using language in everyday situations in Korean, Australian and other cultures, sharing ideas about possible reasons for the differences and variations ",
                        "[Low] struggles to recognise characteristics of Korean pronunciation and intonation patterns, the alphabetical nature of Hangeul, and the structural features of individual syllable blocks including 받침.",
                        "[Low] struggles to understand and use key grammatical forms and structures such as basic pronouns and case markers and the polite verb ending –어/아요 in own simple language production, and recognise politeness embedded in humble or honorific forms such as 저 and –(으)세요",
                        "[Low] struggles to recognise and use vocabulary to describe familiar people, objects and places, and basic routines, including Sino- and pure Korean number words with basic counters, words for colours, names of sports",
                    ]
                ], 5, 0);
                understandingCheckboxesContainer.innerHTML = '';
                createCheckboxes('understandingCheckboxes', [
                    ["[High] can understand that languages change over time and influence each other through contact and cultural exchanges.",
                        "[High] can reflect on and share their experience when using Korean and when using own language/s, recognising cultural elements that may cause different feelings.",
                        "[High] can competently compare and reflect on different ways of using language in everyday situations in Korean, Australian and other cultures, sharing ideas about possible reasons for the differences and variations ",
                        "[Medium] can satisfactorily recognise characteristics of Korean pronunciation and intonation patterns, the alphabetical nature of Hangeul, and the structural features of individual syllable blocks including 받침.",
                        "[Medium] can reflect on and share their experience when using Korean and when using own language/s, recognising cultural elements that may cause different feelings to some degree.",
                        "[Medium] can satisfactorily compare and reflect on different ways of using language in everyday situations in Korean, Australian and other cultures, sharing ideas about possible reasons for the differences and variations ",
                        "[Low] struggles to recognise characteristics of Korean pronunciation and intonation patterns, the alphabetical nature of Hangeul, and the structural features of individual syllable blocks including 받침.",
                        "[Low] struggles to understand and use key grammatical forms and structures such as basic pronouns and case markers and the polite verb ending –어/아요 in own simple language production, and recognise politeness embedded in humble or honorific forms such as 저 and –(으)세요",
                        "[Low] struggles to recognise and use vocabulary to describe familiar people, objects and places, and basic routines, including Sino- and pure Korean number words with basic counters, words for colours, names of sports",
                    ]
                ], 5, 0);
            }
        });
        const gradeValueSpan = document.getElementById('gradeValue');
        gradeSlider.addEventListener('input', () => {
            if (gradeSlider.value === '0') {
                gradeValueSpan.textContent = 'Prep';
            } else {
                gradeValueSpan.textContent = 'Year ' + gradeSlider.value;
            }
        });
        const sliders = ['attendance', 'effort', 'behaviour'];
        sliders.forEach(sliderId => {
            const slider = document.getElementById(sliderId);
            const valueSpan = document.getElementById(sliderId + 'Value');
            slider.addEventListener('input', () => {
                let selectedValue = '';
                switch (slider.value) {
                    case '0':
                        selectedValue = 'Very Low';
                        break;
                    case '1':
                        selectedValue = 'Needs Attention';
                        break;
                    case '2':
                        selectedValue = 'Satisfactory';
                        break;
                    case '3':
                        selectedValue = 'High';
                        break;
                    case '4':
                        selectedValue = 'Excellent';
                        break;
                }
                valueSpan.textContent = `${selectedValue}`;
            });
        });
        document.getElementById('brushBtn').addEventListener('click', function (event) {
            const studentName = document.getElementById('studentName');
            const grade = document.getElementById('grade');
            const attendance = document.getElementById('attendance');
            const effort = document.getElementById('effort');
            const behaviour = document.getElementById('behaviour');
            const overallComment = document.getElementById('overallComment');
            const communicationCheckboxes = document.getElementsByName('communicationCheckboxes');
            const understandingCheckboxes = document.getElementsByName('understandingCheckboxes');

            function getSelectedCheckboxValues(checkboxes) {
                const selectedValues = [];
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        selectedValues.push(checkbox.value);
                    }
                });
                return selectedValues;
            }
            const data = {
                studentName: studentName.value,
                grade: grade.value,
                communicationSkills: getSelectedCheckboxValues(communicationCheckboxes),
                understandingSkills: getSelectedCheckboxValues(understandingCheckboxes),
                attendance: attendance.value,
                effort: effort.value,
                behaviour: behaviour.value
            };
            fetch('/api/mlwklsbrush', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Network response was not ok.');
                })
                .then(responseData => {
                    overallComment.value = responseData.updatedComment;
                    const characterCount = overallComment.value.length;
                    characterCountSpan.textContent = `${characterCount}/${maxCharacters}`;
                })
                .catch(error => {
                    console.error('Error making API call:', error);
                });
        });
        document.getElementById('generateReportBtn').addEventListener('click', function (event) {
            const studentName = document.getElementById('studentName');
            const grade = document.getElementById('grade');
            const attendance = document.getElementById('attendance');
            const effort = document.getElementById('effort');
            const behaviour = document.getElementById('behaviour');
            const overallComment = document.getElementById('overallComment');
            const communicationCheckboxes = document.getElementsByName('communicationCheckboxes');
            const understandingCheckboxes = document.getElementsByName('understandingCheckboxes');

            function getSelectedCheckboxValues(checkboxes) {
                const selectedValues = [];
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        selectedValues.push(checkbox.value);
                    }
                });
                return selectedValues;
            }
            const data = {
                studentName: studentName.value,
                grade: grade.value,
                communicationSkills: getSelectedCheckboxValues(communicationCheckboxes),
                understandingSkills: getSelectedCheckboxValues(understandingCheckboxes),
                attendance: attendance.value,
                effort: effort.value,
                behaviour: behaviour.value,
                overallComment: overallComment.value
            };
            fetch('/api/mlwklsgenerate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    if (response.ok) {
                        return response.blob();
                    }
                    throw new Error('Network response was not ok.');
                })
                .then(blob => {
                    const studentName = document.getElementById('studentName').value.replace(/[^a-zA-Z0-9]/g, '_');
                    const blobWithStudentName = new Blob([blob], { type: 'application/pdf' });
                    const a = document.createElement('a');
                    a.href = window.URL.createObjectURL(blobWithStudentName);
                    a.download = `${studentName}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(a.href);
                    document.body.removeChild(a);
                })
                .catch(error => {
                    console.error('Error generating report:', error);
                });

        });
        const maxCharacters = 1500;
        const overallCommentTextarea = document.getElementById('overallComment');
        const characterCountSpan = document.getElementById('characterCount');
        overallCommentTextarea.addEventListener('input', function () {
            const characterCount = overallCommentTextarea.value.length;
            characterCountSpan.textContent = `${characterCount}/${maxCharacters}`;
            if (characterCount > maxCharacters) {
                overallCommentTextarea.value = overallCommentTextarea.value.substring(0, maxCharacters);
                characterCountSpan.textContent = `${maxCharacters}/${maxCharacters}`;
            }
        });
    </script>
</body>

</html>
