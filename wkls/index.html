<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WKLS Report Generator</title>
    <link rel="stylesheet" href="/wkls/styles.css">
</head>

<body>
    <video autoplay muted loop id="video"></video>
    <script>
        var videoSources = ["/wkls/bg.mp4"];
        var randomIndex = Math.floor(Math.random() * videoSources.length);
        var video = document.getElementById("video");
        video.src = videoSources[randomIndex];
    </script>
    <div class="container">
        <h1>Student Report Card</h1>
        <div class="section">
            <label for="studentName">Student's Name:</label>
            <input type="text" id="studentName" name="studentName">
        </div>
        <div class="section">
            <label for="grade">Grade:</label>
            <select id="grade" name="grade">
                <option value="Prep">Prep</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
            </select>
        </div>
        <div class="section">
            <div class="slider-label">Attendance:</div>
            <input type="range" id="attendance" name="attendance" min="0" max="3" step="1">
            <span class="slider-value" id="attendanceValue">Very Good</span>
        </div>
        <div class="section">
            <div class="slider-label">Effort:</div>
            <input type="range" id="effort" name="effort" min="0" max="3" step="1">
            <span class="slider-value" id="effortValue">Very Good</span>
        </div>
        <div class="section">
            <div class="slider-label">Behavior:</div>
            <input type="range" id="behavior" name="behavior" min="0" max="3" step="1">
            <span class="slider-value" id="behaviorValue">Very Good</span>
        </div>

        <div class="section">
            <h2>Listening</h2>
            <div class="slider-label">Previous Semester:</div>
            <input type="range" id="listeningPreviousSemester" name="listeningPreviousSemester" min="0" max="4"
                step="1">
            <span class="slider-value" id="listeningPreviousSemesterValue">Level 1</span>
            <div class="slider-label">Current Semester:</div>
            <input type="range" id="listeningCurrentSemester" name="listeningCurrentSemester" min="0" max="4"
                step="1">
            <span class="slider-value" id="listeningCurrentSemesterValue">Level 1</span>
            <div class="checkboxes" id="listeningCheckboxes"></div>
        </div>

        <div class="section">
            <h2>Reading</h2>
            <div class="slider-label">Previous Semester:</div>
            <input type="range" id="readingPreviousSemester" name="readingPreviousSemester" min="0" max="4"
                step="1">
            <span class="slider-value" id="readingPreviousSemesterValue">Level 1</span>
            <div class="slider-label">Current Semester:</div>
            <input type="range" id="readingCurrentSemester" name="readingCurrentSemester" min="0" max="4"
                step="1">
            <span class="slider-value" id="readingCurrentSemesterValue">Level 1</span>
            <div class="checkboxes" id="readingCheckboxes"></div>
        </div>

        <div class="section">
            <h2>Speaking</h2>
            <div class="slider-label">Previous Semester:</div>
            <input type="range" id="speakingPreviousSemester" name="speakingPreviousSemester" min="0" max="4"
                step="1">
            <span class="slider-value" id="speakingPreviousSemesterValue">Level 1</span>
            <div class="slider-label">Current Semester:</div>
            <input type="range" id="speakingCurrentSemester" name="speakingCurrentSemester" min="0" max="4"
                step="1">
            <span class="slider-value" id="speakingCurrentSemesterValue">Level 1</span>
            <div class="checkboxes" id="speakingCheckboxes"></div>
        </div>

        <div class="section">
            <h2>Writing</h2>
            <div class="slider-label">Previous Semester:</div>
            <input type="range" id="writingPreviousSemester" name="writingPreviousSemester" min="0" max="4"
                step="1">
            <span class="slider-value" id="writingPreviousSemesterValue">Level 1</span>
            <div class="slider-label">Current Semester:</div>
            <input type="range" id="writingCurrentSemester" name="writingCurrentSemester" min="0" max="4"
                step="1">
            <span class="slider-value" id="writingCurrentSemesterValue">Level 1</span>
            <div class="checkboxes" id="writingCheckboxes"></div>
        </div>

        <div class="section">
            <label for="overallComment">Overall Comment:</label>
            <textarea id="overallComment" class="comment-box"></textarea>
        </div>

        <div class="section">
            <button id="generateReportBtn">Generate Report</button>
        </div>
    </div>

    <script>
        function createCheckboxes(containerId, options, maxAllowed) {
            const container = document.getElementById(containerId);
            let selectedCheckboxes = 0;

            options.forEach(option => {
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.name = containerId;
                checkbox.value = option;

                const label = document.createElement('label');
                label.className = 'checkbox-label';
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(option));

                container.appendChild(label);
                container.appendChild(document.createElement('br'));

                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        selectedCheckboxes++;
                    } else {
                        selectedCheckboxes--;
                    }

                    if (selectedCheckboxes > maxAllowed) {
                        checkbox.checked = false;
                        selectedCheckboxes--;
                    }
                });
            });
        }

        createCheckboxes('listeningCheckboxes', [
            "answers questions about texts being studied",
            "appears to enjoy listening to texts and is able to answer questions about them",
            "attentively repeats teacher-modelled use of the language and participates in oral use of the language",
            // ... (add more options)
        ], 3);

        createCheckboxes('readingCheckboxes', [
            "actively participates in choral reading situations and is able to recognize familiar words",
            "actively participates in shared reading activities",
            "confidently identifies letter-sound relationships",
            // ... (add more options)
        ], 3);

        createCheckboxes('speakingCheckboxes', [
            "actively participates in class discussions and shares ideas using familiar words",
            "actively participates in class language games",
            "actively takes part in short drama activities and has demonstrated very good pronunciation",
            // ... (add more options)
        ], 3);

        createCheckboxes('writingCheckboxes', [
            "a thoughtful and diligent student who has displayed a sound standard in presentation and written expression",
            "accurately copies words and/or sentences",
            "applied knowledge and skills to a high standard in writing tasks",
            // ... (add more options)
        ], 3);

        const sliders = ['attendance', 'effort', 'behavior'];
        sliders.forEach(sliderId => {
            const slider = document.getElementById(sliderId);
            const valueSpan = document.getElementById(sliderId + 'Value');
            slider.addEventListener('input', () => {
                let selectedValue = '';
                switch (slider.value) {
                    case '0':
                        selectedValue = 'Needs Attention';
                        break;
                    case '1':
                        selectedValue = 'Satisfactory';
                        break;
                    case '2':
                        selectedValue = 'Very Good';
                        break;
                    case '3':
                        selectedValue = 'Excellent';
                        break;
                }
                valueSpan.textContent = `${selectedValue}`;
            });
        });
        const skillSliders = ['listeningPreviousSemester', 'listeningCurrentSemester', 'readingPreviousSemester', 'readingCurrentSemester', 'speakingPreviousSemester', 'speakingCurrentSemester', 'writingPreviousSemester', 'writingCurrentSemester'];
        skillSliders.forEach(sliderId => {
            const slider = document.getElementById(sliderId);
            const valueSpan = document.getElementById(sliderId + 'Value');
            slider.addEventListener('input', () => {
                let selectedValue = '';
                switch (slider.value) {
                    case '0':
                        selectedValue = 'Level D';
                        break;
                    case '1':
                        selectedValue = 'Foundation';
                        break;
                    case '2':
                        selectedValue = 'Level 1';
                        break;
                    case '3':
                        selectedValue = 'Level 2';
                        break;
                    case '4':
                        selectedValue = 'Level 3';
                        break;
                }
                valueSpan.textContent = `${selectedValue}`;
            });
        });

        document.getElementById('generateReportBtn').addEventListener('click', function(event) {
            const studentName = document.getElementById('studentName');
            const grade = document.getElementById('grade');
            const attendance = document.getElementById('attendance');
            const effort = document.getElementById('effort');
            const behavior = document.getElementById('behavior');
            const listeningPreviousSemester = document.getElementById('listeningPreviousSemester');
            const listeningCurrentSemester = document.getElementById('listeningCurrentSemester');
            const readingPreviousSemester = document.getElementById('readingPreviousSemester');
            const readingCurrentSemester = document.getElementById('readingCurrentSemester');
            const speakingPreviousSemester = document.getElementById('speakingPreviousSemester');
            const speakingCurrentSemester = document.getElementById('speakingCurrentSemester');
            const writingPreviousSemester = document.getElementById('writingPreviousSemester');
            const writingCurrentSemester = document.getElementById('writingCurrentSemester');
            const overallComment = document.getElementById('overallComment');
            const listeningCheckboxes = document.getElementsByName('listeningCheckboxes');
            const readingCheckboxes = document.getElementsByName('readingCheckboxes');
            const speakingCheckboxes = document.getElementsByName('speakingCheckboxes');
            const writingCheckboxes = document.getElementsByName('writingCheckboxes');

            function getSelectedCheckboxValues(checkboxes) {
                const selectedValues = [];
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        selectedValues.push(checkbox.value);
                    }
                });
                return selectedValues;
            }
            const data = {
                studentName: studentName.value,
                grade: grade.value,
                attendance: attendance.value,
                effort: effort.value,
                behavior: behavior.value,
                listeningPreviousSemester: listeningPreviousSemester.value,
                listeningCurrentSemester: listeningCurrentSemester.value,
                readingPreviousSemester: readingPreviousSemester.value,
                readingCurrentSemester: readingCurrentSemester.value,
                speakingPreviousSemester: speakingPreviousSemester.value,
                speakingCurrentSemester: speakingCurrentSemester.value,
                writingPreviousSemester: writingPreviousSemester.value,
                writingCurrentSemester: writingCurrentSemester.value,
                overallComment: overallComment.value,
                listeningSkills: getSelectedCheckboxValues(listeningCheckboxes),
                readingSkills: getSelectedCheckboxValues(readingCheckboxes),
                speakingSkills: getSelectedCheckboxValues(speakingCheckboxes),
                writingSkills: getSelectedCheckboxValues(writingCheckboxes)
            };
            fetch('/api/mlwkls', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (response.ok) {
                    return response.blob();
                }
                throw new Error('Network response was not ok.');
            })
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'report.pdf';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            })
            .catch(error => {
                console.error('Error generating report:', error);
            });
        });
    </script>
</body>

</html>
